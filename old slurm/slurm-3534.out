clang++ -std=c++14 -stdlib=libc++ -O3 -ferror-limit=2 -Weverything -Wno-c++98-compat -Wno-c++98-compat-pedantic -Wno-sign-conversion -Wno-exit-time-destructors -Wno-float-equal -Wno-global-constructors -Wno-missing-declarations -Wno-unused-parameter -Wno-padded -Wno-shadow -Wno-weak-vtables -Wno-missing-prototypes -Wno-unused-variable -ferror-limit=1 -Wno-deprecated -Wno-conversion -Wno-double-promotion -c src/direct_cuda_pattern.cc -o ./obj/direct_cuda_pattern.o -Iinclude -I/usr/local/cuda/include -I/usr/local/include -I/usr/include/c++/v1
nvcc src/cuda_pattern.cu -o ./obj/_cuda_pattern.o -Iinclude -I/usr/local/cuda/include -I/usr/local/include -I/usr/include/c++/v1 -m64 -dc -gencode arch=compute_70,code=sm_70 --relocatable-device-code true  -Xptxas -v
ptxas info    : 9754 bytes gmem
ptxas info    : Compiling entry function '_Z5ZaxpymddP7double2S0_' for 'sm_70'
ptxas info    : Function properties for _Z5ZaxpymddP7double2S0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 30 registers, 392 bytes cmem[0]
ptxas info    : Function properties for cudaGetDevice
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z5DasummP7double2Pd' for 'sm_70'
ptxas info    : Function properties for _Z5DasummP7double2Pd
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 26 registers, 1024 bytes smem, 376 bytes cmem[0]
ptxas info    : Compiling entry function '_Z8sum_diagP7double2mdd' for 'sm_70'
ptxas info    : Function properties for _Z8sum_diagP7double2mdd
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 10 registers, 384 bytes cmem[0]
ptxas info    : Compiling entry function '_Z5ZgemmP7double2S0_S0_md' for 'sm_70'
ptxas info    : Function properties for _Z5ZgemmP7double2S0_S0_md
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 8704 bytes smem, 392 bytes cmem[0]
ptxas info    : Function properties for cudaFuncGetAttributes
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Function properties for cudaOccupancyMaxActiveBlocksPerMultiprocessorWithFlags
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z22extract_intensity_diffP7double2PdS1_mm' for 'sm_70'
ptxas info    : Function properties for _Z22extract_intensity_diffP7double2PdS1_mm
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 24 registers, 392 bytes cmem[0], 8 bytes cmem[2]
ptxas info    : Compiling entry function '_Z9compose_aPdPmS_dP7double2m' for 'sm_70'
ptxas info    : Function properties for _Z9compose_aPdPmS_dP7double2m
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 30 registers, 400 bytes cmem[0]
ptxas info    : Function properties for cudaOccupancyMaxActiveBlocksPerMultiprocessor
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z5ZscalmdP7double2' for 'sm_70'
ptxas info    : Function properties for _Z5ZscalmdP7double2
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 27 registers, 376 bytes cmem[0]
ptxas info    : Function properties for cudaMalloc
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z38make_individual_pattern_intensity_diffPdS_PmS_dS0_S_S_mP7double2mm' for 'sm_70'
ptxas info    : Function properties for _Z38make_individual_pattern_intensity_diffPdS_PmS_dS0_S_S_mP7double2mm
    24 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 72 registers, 448 bytes cmem[0], 104 bytes cmem[2]
ptxas info    : Compiling entry function '_Z5ZcopymP7double2S0_' for 'sm_70'
ptxas info    : Function properties for _Z5ZcopymP7double2S0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 28 registers, 376 bytes cmem[0]
ptxas info    : Function properties for cudaDeviceGetAttribute
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z6Dznrm2mP7double2Pd' for 'sm_70'
ptxas info    : Function properties for _Z6Dznrm2mP7double2Pd
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 28 registers, 1024 bytes smem, 376 bytes cmem[0]
ptxas info    : Compiling entry function '_Z34extract_intensity_diff_with_offsetP7double2PdS1_S1_mmdd' for 'sm_70'
ptxas info    : Function properties for _Z34extract_intensity_diff_with_offsetP7double2PdS1_S1_mmdd
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 24 registers, 416 bytes cmem[0], 8 bytes cmem[2]
nvcc -dlink ./obj/_cuda_pattern.o -arch=sm_70 -o ./obj/cuda_pattern.o -m64 -lcudadevrt -L/usr/local/cuda/lib64  -rdc=true -Xptxas -v
clang++ -o ./bin/direct_cuda_pattern ./obj/_cuda_pattern.o ./obj/direct_cuda_pattern.o ./obj/cuda_pattern.o  -lcudadevrt -lcublas -lcudart -m64 -L/usr/local/cuda/lib64  -lc++ -lc++abi -O3 -pthread

solution:
(0.91563820675641882652,0.00032665977078733519391)	
(0.01290262221962541235,0.00025665463982683331965)	
(0.013373437600802009009,-0.001399488322166766302)	
(0.014823159592621457797,0.003113303679387731393)	
(0.014980939912859415203,-0.00038206323071323256696)	
(0.0029255100058065653876,-0.0065456701468378638772)	
(0.0066268403138129922461,-0.0010026042645744825867)	
(0.010571947842402109816,0.0088085694585988590088)	
(0.0086110150761934504959,0.0021018463583805930932)	
(0.002014603798898438082,0.00028863551819620667871)	
(0.0033659905375266062529,0.0046436805376933497705)	
(0.0078337164044823461712,-0.0096163148365173284349)	
(0.0095658439799542090143,-0.0020297799473189782546)	
(-0.0015624839252850405719,0.0023430783868963536709)	
(0.0074453905459881770598,0.00044755408366113901561)	
(0.018750302907471309843,-0.01101394877054389515)	
(0.0085693344324104248066,-0.00074813869011829321233)	
(0.0082574856348496591257,0.0057680477739252720634)	
(0.014616064559916260718,0.00087473711980431501176)	
(0.012612192942369173515,0.00042413516593189042438)	
(0.019544876960203339672,0.012935768354330667504)	
(0.0065485788749505020184,-0.0067922542943805791146)	
(0.0087664358933071794694,-0.00042233533142276019493)	
(0.015484443671013495281,0.0011770957659909052177)	
(0.014376452485651395469,0.0016495523856234735674)	
(0.0054548572346148106738,-0.00331682340142933638)	
(0.00379302253482906521,0.0035964398677525129602)	
(0.0017558308147259114092,-0.00015834598591744314757)	
(0.01757119910468188731,0.0092059646647556381965)	
(0.007428401556866587839,0.0013653010269611841245)	
(0.0092633684087763869947,0.0014375985052561825964)	
(0.011357892968403669395,0.0031408491999124466508)	
(0.0074585931931632114614,0.0016883591076661105725)	
(0.012372342831269691685,-0.0072932481500352286038)	
(0.01363435898005359824,-0.0065669947042393235839)	
(0.0098521639334059607496,0.0035309757289645371699)	
(0.0064168154654648031782,0.0055441899381450691561)	
(0.013630476604312597236,-0.0092210906440537560025)	
(0.0029844726673266853967,-0.0011134516508125144509)	
(0.0092251175546743842404,0.0023519558003002329592)	
(0.015747787731467816075,0.0051256969292030754928)	
(0.014254806892994350415,-0.00060033901464190213802)	
(0.0081108445765309712672,-0.0057898904012836623426)	
(0.0053943622678442378765,0.0074689120062547062484)	
(0.011528276856851019452,-0.016904958648388479503)	
(0.0061647184714814706394,-0.0031635206240623854959)	
(0.022189512173509003817,-0.007769938611310398674)	
(0.0017765036650974268088,-0.00034237861434672378245)	
(0.013167127984519211639,0.00038063459852196937375)	
(0.011738602609993096723,0.014654354369012656881)	
(0.0050253825975510842475,-0.0079972280063336856348)	
(0.0068543997312734694649,-0.00070520570035961295009)	
(-0.00099984948119696067,0.002256373687657863697)	
(6.7368937769078952589e-05,9.1260922951213845067e-05)	
(0.0065072561965588259641,-0.0044906952299346063542)	
(0.011409562026624233896,0.01119310916012696)	
(0.011876467157487637441,4.6776647281236233495e-05)	
(0.0022542348666388591256,0.0047207320328699715548)	
(0.01060544114546706565,0.0050142742316981337575)	
(0.008714179123135327304,0.017324589340546904526)	
(0.0018827228419348606726,0.0038179986761913134105)	
(-1.3899254921298119506e-05,0.0072856193669755976022)	
(0.0070863808441492225076,0.0057001318032512075101)	
(0.014766927930585488013,0.0045149488063981500427)	
(0.0051054427138247380005,0.003558275361112334112)	
(0.015585576910719177446,0.0035160982365633271403)	
(0.010782934840468459681,-0.0012142639337857285761)	
(0.010852571231920566178,-0.00097487744539312165982)	
(0.0030115992651195853599,-0.00012362094754331612052)	
(0.0096572438809184105168,-0.0045192510629074944886)	
(0.0038475103980807963573,-0.0070658534283777867796)	
(0.0091520548183682461779,-0.0039091032334877652901)	
(0.0098788794024399616961,-0.0053542848175003746394)	
(-0.0016777984830965116721,-0.0074782164042157444131)	
(0.012622752309781787999,-0.0073145797349306995033)	
(0.0060859685251133483971,0.0045264700807034694008)	
(0.0093478924243784195652,0.0023332585415860450546)	
(0.0078495636695714871706,-0.0067188669008077699443)	
(0.017414716654684428421,0.010642816051813851208)	
(-0.011074252959500570717,0.011749331865278258777)	
(0.0086284953220609524743,-0.0052115722324683763991)	
(0.0087723081433770042081,-0.0062573932207834080318)	
(0.003180240782313299621,-0.0024988886233113919745)	
(0.0017369270695762170555,0.0026436367607364560234)	
(0.012865515043063621356,-0.0052147391289461596589)	
(0.0028892791684831642916,0.0018725213134628041454)	
(0.00066790932631263257285,0.0025626686531319080829)	
(-0.0011329829495698216877,0.0033810999640033817179)	
(0.00085795916620508413594,-0.0055044921915209264404)	
(0.0055709154688392062416,0.0039217694742091123786)	
(0.008015583499095674247,0.0007058542363701424344)	
(0.010638035385960234805,0.0069246440252680235491)	
(0.0098913542400210271305,-0.0032344484334798609577)	
(0.0035793550233969972235,-0.0058047930354837521533)	
(0.0032016328515266107707,-0.006173681309798745992)	
(-0.00072429891939758623068,0.013079490252391696992)	
(0.0099645705928554356018,0.018340270462050847766)	
(0.0084438212086084731695,0.005739802665906889971)	
(0.0021488892908589764079,-0.04384521931848692905)	
(0.003277942658259091601,-0.0018058933229390520571)	
(0.0012134314291134082765,-0.009662077421120282561)	
(0.0065158437305207891552,-0.023641415955205455357)	
(0.0034165184495851042869,0.010087385754350253197)	
(-0.0087904089414169803846,-0.017214928775986276105)	
(-0.0074447736417973435843,0.015254145000893571879)	


real	375m31.030s
user	261m56.868s
sys	112m4.176s
